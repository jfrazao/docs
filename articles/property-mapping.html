<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Property Mapping </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Property Mapping ">
    <meta name="generator" content="docfx 2.59.4.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    <meta property="docfx:newtab" content="true">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <div class="masthead">
          <div class="masthead__inner-wrap container">
            <div class="masthead__menu">
              <nav id="site-nav" class="greedy-nav">
                
                <a class="navbar-brand" href="//bonsai-rx.org/">
                  <img id="logo" class="svg" src="../logo.svg" alt="">
                </a>
                <ul class="visible-links">
                  <li class="masthead__menu-item"><a href="../.">Docs</a></li>
                  <li class="masthead__menu-item"><a href="//bonsai-rx.org/learn">Learn</a></li>
                  <li class="masthead__menu-item"><a href="//bonsai-rx.org/community">Community</a></li>
                </ul>
                <button class="greedy-nav__toggle hidden" type="button">
                  <div class="navicon"></div>
                </button>
                <ul class="hidden-links hidden"></ul>
              </nav>
            </div>
          </div>
        </div>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="property-mapping">
<h1 id="property-mapping">Property Mapping</h1>

<p>Each Bonsai operator exposes a set of configuration properties that allow you to parameterize that operator's behaviour. These parameters can be configured manually from the editor <code>Properties</code> panel. However, there are times when you may need to map the properties of an operator dynamically from the output of other observable sequences.</p>
<p>As an example, imagine you wanted to continuously playback a sound WAV file to the speakers at a specified volume level. You might design a workflow that looks like the following:</p>
<p><img src="../images/language-wavplayback.svg" alt="WAV file playback"></p>
<p>Using the <a class="xref" href="../api/Bonsai.Dsp.ConvertScale.html"><code>ConvertScale</code></a> operator you could set the volume manually by changing its <a class="xref" href="../api/Bonsai.Dsp.ConvertScale.html#Bonsai_Dsp_ConvertScale_Scale"><code>Scale</code></a> parameter.</p>
<p>Now consider a variation of this workflow where the playback volume needs to be modulated continuously depending on some other variable, for example the horizontal position of the mouse cursor as it moves across the screen.</p>
<p>A simple way to compute the desired scale value would be to rescale the X coordinate of mouse movements to a range between zero and one:</p>
<p><img src="../images/language-mouserescale.svg" alt="Rescaled mouse position"></p>
<p>However, how would you now connect the sequence of scale values computed from the mouse position to changes in the <a class="xref" href="../api/Bonsai.Dsp.ConvertScale.html#Bonsai_Dsp_ConvertScale_Scale"><code>Scale</code></a> property of the <a class="xref" href="../api/Bonsai.Dsp.ConvertScale.html"><code>ConvertScale</code></a> node?</p>
<p>Property mapping operators allow you to do exactly this. They are operators that take a single input sequence and react to notifications from that sequence by changing the values of the specified properties in the <em>subsequent</em> node. There are three types of property mapping operators, described below.</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Mapping Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><img src="../images/language-externalizedmapping.svg" alt="Externalized mapping"></td>
<td>Externalize one or more operator properties. The properties can be optionally named and will show up in the <code>Properties</code> panel for node groups.</td>
</tr>
<tr>
<td style="text-align: center;"><img src="../images/language-propertymapping.svg" alt="Property mapping"></td>
<td>Map multiple properties simultaneously. Individual members of input data items can be mapped to different properties in the target node.</td>
</tr>
<tr>
<td style="text-align: center;"><img src="../images/language-inputmapping.svg" alt="Input mapping"></td>
<td>Map multiple properties synchronized with input notifications. Same as above, but property changes are applied only when a notification is transmitted to the target node.</td>
</tr>
</tbody>
</table>
<h2 id="externalized-properties">Externalized properties</h2>
<p>The <a class="xref" href="../api/Bonsai.Expressions.ExternalizedMappingBuilder.html">ExternalizedMapping</a> operator allows you to create externalized properties. The easiest way to initialize the mapping is from the right-click context menu when a single node is selected. Selecting a property from this menu will create or update the externalized mapping node. Multiple properties can be externalized from the same node.</p>
<p><img src="../images/language-externalizedproperty.png" alt="Externalized property"></p>
<div class="WARNING">
<h5>Warning</h5>
<p>In any one workflow, it is not possible to have more than one externalized property with the same name. When externalizing multiple conflicting properties, you can use the <a class="xref" href="../api/Bonsai.Expressions.ExternalizedMapping.html#Bonsai_Expressions_ExternalizedMapping_DisplayName"><code>DisplayName</code></a> property of the externalized mapping to provide distinct unique names for each property. It is also possible to specify different category or description strings to the externalized property for documentation purposes.</p>
</div>
<p>When externalized properties are nested inside an operator group, for example inside a <a class="xref" href="../api/Bonsai.Expressions.GroupWorkflowBuilder.html"><code>GroupWorkflow</code></a>, they will be exposed as member properties of the node group itself. This means that when the group node is selected, all named externalized properties will show up in the <code>Properties</code> panel.</p>
<h2 id="mapping-a-sequence-to-a-property">Mapping a sequence to a property</h2>
<p>After an operator property has been externalized, you can connect any sequence which is compatible with the data type of the property to the mapping node. When a connection to a source sequence is established, the externalized property will be promoted to a <a class="xref" href="../api/Bonsai.Expressions.PropertyMappingBuilder.html"><code>PropertyMapping</code></a> operator.</p>
<p>Now every time the source sequence emits a new notification, the mapping operator will react by changing the target property to the incoming value.</p>
<p><img src="../images/language-wavplayback-mapping.svg" alt="Rescale WAV playback with mouse position"></p>
<p>The connection between the property mapping and its target node only affects the state of properties. The behaviour of the operator will otherwise remain unaffected, since the subscription to the mapping is not considered as a proper upstream source. This is indicated in the editor by the dashed line linking the property mapping operator to its target.</p>
<div class="WARNING">
<h5>Warning</h5>
<p>Because property values are updated independently, this means that values can change even while the target operator is reacting to notifications from other nodes. Care must be taken to ensure that changing the property state in this way does not break the behaviour of the workflow.</p>
<p>Specifically, some operators respond to changes in their parameters only at specific moments. For example, the parameters of the <a class="xref" href="../api/Bonsai.Reactive.Timer.html"><code>Timer</code></a> operator must be set before the observable sequence is initialized. In this case, the input to the externalized property needs to be emitted immediately during the subscription phase for the mapping to work.</p>
</div>
<h2 id="mapping-multiple-properties">Mapping multiple properties</h2>
<p>Multiple properties can be mapped simultaneously from the same source sequence when using <code>PropertyMapping</code>. You can select which properties to map by using the editors available in the property grid. For each mapped property you must specify a source selector, i.e. an expression specifying which members of the input data type are used to assign values to the mapped property.</p>
<div class="NOTE">
<h5>Note</h5>
<p>If the type of the selected member does not match the type of the property, a conversion is attempted. If no compatible conversion is available, the compiler checks whether it is possible to construct the corresponding data type from the selected members. For example, it would be possible to map to a <a class="xref" href="https://horizongir.github.io/opencv.net/api/OpenCV.Net.Point.html"><strong>Point</strong></a> type by selecting two numeric values from the source sequence. In this case, the values would be used to construct a new point instance by assigning them to the X and Y parameters of the type constructor.</p>
</div>
<p>In each property mapping operator, all mapped properties are updated at the same time every time the source sequence sends out a new value. It is also possible to connect property mapping operators to multiple target nodes.</p>
<h2 id="mapping-properties-synchronously">Mapping properties synchronously</h2>
<p>Sometimes you need to synchronize property updates with the data flow, i.e. you do not want the property mapping operator to change the property values outside of notifications emitted by the source sequence.</p>
<p>For example, imagine a transform operator which is converting a source sequence from one format to another, where the format specification is given by a set of operator properties. You may need the target format to change dynamically from time to time, but you may also need to guarantee that parts of the format specification do not change while the operator was converting some other input. The <a class="xref" href="../api/Bonsai.Expressions.InputMappingBuilder.html"><code>InputMapping</code></a> operator allows you to do this by synchronizing property updates with input notifications.</p>
<p>Fundamentally, the <code>InputMapping</code> operator works exactly the same way as <a class="xref" href="../api/Bonsai.Expressions.PropertyMappingBuilder.html"><code>PropertyMapping</code></a>, but now the connection from the mapping operator to its target node is done through the upstream sources. In this case, only values from the source sequence can be used to map properties in the target node. However, it is possible to specify which specific member of the original data source will be selected as input to the target node by setting the <a class="xref" href="../api/Bonsai.Expressions.InputMappingBuilder.html#Bonsai_Expressions_InputMappingBuilder_Selector">Selector</a> property.</p>
<p>Whenever the original input sequence sends out a new data item, all the specified property mappings will be updated at the same time before this item is finally allowed to go through and notify the target. In this way, you can be sure that no property changes are performed between upstream notifications.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/bonsai-rx/docs/blob/main/articles/property-mapping.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    <script type="text/javascript" src="../styles/jquery.greedy-navigation.js"></script>
  </body>
</html>
